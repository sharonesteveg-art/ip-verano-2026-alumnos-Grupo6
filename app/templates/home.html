{% extends 'header.html' %} {% block content %}
<main>
    <h1 class="text-center">Buscador de personajes de Los Simpsons</h1>

    <!-- B칰squeda por nombre (GET) -->
    <div class="d-flex justify-content-center mb-3">
        <form class="d-flex gap-2" action="{% url 'home' %}" method="GET" id="search-form">
            <input class="form-control me-2" type="search" name="q" placeholder="Homer, Marge, Bart, Lisa..." aria-label="Search" value="{{ q }}">
            <button class="btn btn-outline-success" type="submit">Buscar</button>
            <a href="{% url 'home' %}" class="btn btn-outline-secondary ms-2">Limpiar</a>
        </form>
    </div>

    <!-- Cuadros grandes para filtrar por estado (Vivos / Fallecidos / Todos) -->
    <div class="d-flex gap-3 justify-content-center mb-3">
        <form method="post" action="{% url 'filter_by_status' %}">
            {% csrf_token %}
            <input type="hidden" name="status" value="Alive">
            <input type="hidden" name="q" value="{{ q }}">
            <button type="submit" class="btn btn-success border shadow p-3 text-center text-white" style="width:180px; height:90px;">
                <div class="fw-bold">VIVOS</div>
                <div>Mostrar vivos</div>
            </button>
        </form>

        <form method="post" action="{% url 'filter_by_status' %}">
            {% csrf_token %}
            <input type="hidden" name="status" value="Deceased">
            <input type="hidden" name="q" value="{{ q }}">
            <button type="submit" class="btn btn-danger border shadow p-3 text-center text-white" style="width:180px; height:90px;">
                <div class="fw-bold">FALLECIDOS</div>
                <div>Mostrar fallecidos</div>
            </button>
        </form>

        <form method="get" action="{% url 'home' %}">
            <input type="hidden" name="status" value="all">
            <input type="hidden" name="q" value="{{ q }}">
            <button type="submit" class="btn btn-warning border shadow p-3 text-center" style="width:180px; height:90px;">
                <div class="fw-bold">TODOS</div>
                <div>Mostrar todos</div>
            </button>
        </form>
    </div>

    <!-- Contenedor de filas: aqu칤 agrupo las columnas en una fila de Bootstrap -->
    <div class="row">
        {% if images|length == 0 %}
        <h2 class="text-center">La b칰squeda no arroj칩 resultados...</h2>
        {% else %}
            {% for img in images %}
            <!-- Columna responsive:
                 col-12 -> 1 por fila en pantallas muy peque침as
                 col-sm-6 -> 2 por fila en pantallas peque침as
                 col-md-4 -> 3 por fila en pantallas medianas y grandes
                 mb-4 -> margen inferior para separar filas -->
            <div class="col-12 col-sm-6 col-md-4 mb-4">
                <!-- Card:
                     h-100 -> hace que la card ocupe toda la altura de la columna
                     la clase de borde se elige seg칰n el estado -->
                {% comment %} Si el filtro est치 en 'all' mostramos todas las cards con borde amarillo. {% endcomment %}
                <div class="card h-100 {% if status == 'all' %}border-warning{% elif img.status == 'Alive' %}border-success{% elif img.status == 'Deceased' %}border-danger{% else %}border-warning{% endif %}">
                    <div class="row no-gutters">
                        <!-- Columna interna para la imagen (dentro de la card) -->
                        <div class="col-4 d-flex align-items-center justify-content-center p-3">
                         <img src="{{ img.image }}" 
                             class="rounded-circle border border-3 border-dark"
                             alt="{{ img.name }}"
                             style="width: 150px; height: 150px; object-fit: cover;"> 
 
                        </div>
                        <!-- Columna interna para el contenido de la card -->
                        <div class="col-8">
                            <div class="card-body">
                                <h3 class="card-title text-dark fw-bold">{{ img.name }}</h3>
                                <div class="alert alert-warning" role="alert">
                                    <strong><em>"{{ img.phrases }}"</em></strong>
                                </div>
                                <p class="card-text"><small class="text-body-secondary">游녻 G칠nero: {{ img.gender }}</small></p>
                                {% if img.age %}
                                <p class="card-text"><small class="text-body-secondary">游꾹 Edad: {{ img.age }} a침os</small></p>
                                {% endif %}
                                <p class="card-text"><small class="text-body-secondary">{% if status == 'all' %}游리{% elif img.status == 'Alive' %}游릭{% elif img.status == 'Deceased' %}游댮{% else %}仇늩% endif %} Estado: {{ img.status }}</small></p>
                                <p class="card-text"><small class="text-body-secondary">游눺 Ocupaci칩n: {{ img.occupation }}</small></p>
                            </div>

                            {% if request.user.is_authenticated %}
                            <div class="card-footer text-center">
                                <form method="post" action="{% url 'agregar-favorito' %}">
                                    {% csrf_token %}
                                    <input type="hidden" name="name" value="{{ img.name }}">
                                    <input type="hidden" name="gender" value="{{ img.gender }}">
                                    <input type="hidden" name="status" value="{{ img.status }}">
                                    <input type="hidden" name="occupation" value="{{ img.occupation }}">
                                    <input type="hidden" name="phrases" value="{{ img.phrases }}">
                                    <input type="hidden" name="age" value="{{ img.age }}">
                                    <input type="hidden" name="image" value="{{ img.image }}">
                                    {% if img in favourite_list %}
                                    <button type="submit" class="btn btn-primary btn-sm" disabled>九덢잺 Favoritos</button>
                                    {% else %}
                                    <button type="submit" class="btn btn-primary btn-sm">仇벒잺 Favoritos</button>
                                    {% endif %}
                                </form>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% endif %}
    </div>
        {% if page_obj and page_obj.paginator.num_pages > 1 %}
        <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center mt-4">
                {% if page_obj.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?q={{ q }}&status={{ status }}&page={{ page_obj.previous_page_number }}">Anterior</a>
                    </li>
                {% else %}
                    <li class="page-item disabled"><span class="page-link">Anterior</span></li>
                {% endif %}

                <li class="page-item disabled"><span class="page-link">P치gina {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span></li>

                {% if page_obj.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?q={{ q }}&status={{ status }}&page={{ page_obj.next_page_number }}">Siguiente</a>
                    </li>
                {% else %}
                    <li class="page-item disabled"><span class="page-link">Siguiente</span></li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}
</main>

<style>
.spinner {
    border: 6px solid #f3f3f3;
    border-top: 6px solid #198754;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    animation: spin 1s linear infinite;
    margin: auto;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>

<script>
var sf = document.getElementById("search-form");
if (sf) {
    sf.addEventListener("submit", function() {
        var spinner = document.getElementById("loading-spinner");
        if (spinner) spinner.style.display = "block";
    });
}
</script>

 
{% endblock %} 