{% extends 'header.html' %} {% block content %}
<main>
    <h1 class="text-center">Buscador de personajes de Los Simpsons</h1>

    <div class="d-flex justify-content-center" style="margin-bottom: 1%">
        <!-- Buscador del sitio -->
        <form class="d-flex" action="{% url 'buscar' %}" method="POST">
            {% csrf_token %}
            <input class="form-control me-2" type="search" name="query" placeholder="Homer, Marge, Bart, Lisa..." aria-label="Search">
            <button class="btn btn-outline-success" type="submit">Buscar</button>
        </form>
    </div>

    <div class="d-flex gap-1 col-2 mx-auto mb-3">
        <form method="post" action="{% url 'filter_by_status' %}">
            {% csrf_token %}
            <input type="hidden" name="status" value="Alive">
            <button type="submit" class="btn btn-success">Vivos</button>
        </form>

        <form method="post" action="{% url 'filter_by_status' %}">
            {% csrf_token %}
            <input type="hidden" name="status" value="Deceased">
            <button type="submit" class="btn btn-secondary">Fallecidos</button>
        </form>
    </div>

    <!-- Contenedor de filas: aqu√≠ agrupo las columnas en una fila de Bootstrap -->
    <div class="row">
        {% if images|length == 0 %}
        <h2 class="text-center">La b√∫squeda no arroj√≥ resultados...</h2>
        {% else %}
            {% for img in images %}
            <!-- Columna responsive:
                 col-12 -> 1 por fila en pantallas muy peque√±as
                 col-sm-6 -> 2 por fila en pantallas peque√±as
                 col-md-4 -> 3 por fila en pantallas medianas y grandes
                 mb-4 -> margen inferior para separar filas -->
            <div class="col-12 col-sm-6 col-md-4 mb-4">
                <!-- Card:
                     h-100 -> hace que la card ocupe toda la altura de la columna
                     la clase de borde se elige seg√∫n el estado -->
                <div class="card h-100 {% if img.status == 'Alive' %}border-success{% elif img.status == 'Deceased' %}border-secondary{% else %}border-warning{% endif %}">
                    <div class="row no-gutters">
                        <!-- Columna interna para la imagen (dentro de la card) -->
                        <div class="col-4 d-flex align-items-center justify-content-center p-3">
                            <img src="{{ img.image }}" class="rounded-circle border border-3 border-dark" alt="{{ img.name }}" style="width: 150px; height: 150px; object-fit: cover;">
                        </div>

                        <!-- Columna interna para el contenido de la card -->
                        <div class="col-8">
                            <div class="card-body">
                                <h3 class="card-title text-dark fw-bold">{{ img.name }}</h3>
                                <div class="alert alert-warning" role="alert">
                                    <strong><em>"{{ img.phrases }}"</em></strong>
                                </div>
                                <p class="card-text"><small class="text-body-secondary">üë§ G√©nero: {{ img.gender }}</small></p>
                                {% if img.age %}
                                <p class="card-text"><small class="text-body-secondary">üéÇ Edad: {{ img.age }} a√±os</small></p>
                                {% endif %}
                                <p class="card-text"><small class="text-body-secondary">{% if img.status == 'Alive' %}üü¢{% elif img.status == 'Deceased' %}‚ö´{% else %}‚ùì{% endif %} Estado: {{ img.status }}</small></p>
                                <p class="card-text"><small class="text-body-secondary">üíº Ocupaci√≥n: {{ img.occupation }}</small></p>
                            </div>

                            {% if request.user.is_authenticated %}
                            <div class="card-footer text-center">
                                <form method="post" action="{% url 'agregar-favorito' %}">
                                    {% csrf_token %}
                                    <input type="hidden" name="name" value="{{ img.name }}">
                                    <input type="hidden" name="gender" value="{{ img.gender }}">
                                    <input type="hidden" name="status" value="{{ img.status }}">
                                    <input type="hidden" name="occupation" value="{{ img.occupation }}">
                                    <input type="hidden" name="phrases" value="{{ img.phrases }}">
                                    <input type="hidden" name="age" value="{{ img.age }}">
                                    <input type="hidden" name="image" value="{{ img.image }}">
                                    {% if img in favourite_list %}
                                    <button type="submit" class="btn btn-primary btn-sm" disabled>‚úîÔ∏è Favoritos</button>
                                    {% else %}
                                    <button type="submit" class="btn btn-primary btn-sm">‚ù§Ô∏è Favoritos</button>
                                    {% endif %}
                                </form>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% endif %}
    </div>
</main>
{% endblock %}